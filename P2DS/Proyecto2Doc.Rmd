---
title: "Proyecto 2 DataScience"
author: "Jose Javier Jo"
date: "28 de agosto de 2019"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE, warning = FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Resumen de información
En los avances de proyecto 1, se había presentado el análisis exploratorio del archivo equivocado. Por ello, el primer paso fue realizar análisis exploratorio sobre los archivos que incluyen únicamente las ventas por sector, así como la distribución de cada sector. 
<<<<<<< HEAD
=======

>>>>>>> master
## Objetivos
* Separar las ventas por sectores.
* Crear una predicción sobre la ventas a partir de líneas de tiempo generadas con los datos que se tienen por sector de los últimos 4 años.
* Verificar la eficiencia del modelo comparando las gráficas de tiempo con la historia económica de los últimos 4 años.

## Variables de interés
* Ventas: es una variable cuantitativa la cual será clave para las predicciones.
* Mes y año de venta: variable cuantitativa indispensable para la creación de una serie de tiempo. 
* Sector: variable de carácter cualitativo dado que indica la pertenencia de una venta a un sector asignado en un país.

## Variables Respuesta
* Modelo de predicción a partir de la serie de tiempo. 

```{r echo=FALSE, warning=FALSE, include=FALSE}
# Librerias a utilizar
require(ggpubr) # Para mejorar la visualización gráfica
require(tidyverse) # Para explotar, manipular y visualizar datos que comparten info
require(corrplot) # Para visualizar la matriz de correlación
require(cluster) #Para calcular la silueta
library(fpc) # Para hacer el plotcluster
library(NbClust) # Para determinar el numero de clusters optimo
library(factoextra) # Para hacer graficos bonitos de clustering
library(rela) # Para poder utilizar paf()
library(psych) # Para poder utilizar KMO()
#library(FactoMineR)
library(corrplot)
library(REdaS)
library(ggplot2) # Graficas bonitas
#library(ggpubr) # Graficas bonitas x2
#library(ggmap)
library(arules) # Reglas de asociacion
library(factoextra) 
library(arulesViz)
library(dplyr)
#library(caret) # Muestreo estratificado
library(class) # Para KNN
library(e1071) # Requisito para la matriz de confusión
library(openxlsx)
```
```{r echo=FALSE}
#"/Users/quiebres/Documents/Ivan Maldonado/UVG/Sexto Semestre/Data Science/Proyecto2DS"
# /Users/odalisrg/Documents/Semestre 6/Data Science/Proyecto2DS/P2DS
# F:/Data Science/Proyecto 2/Proyecto2DS
setwd("/Users/quiebres/Documents/Ivan Maldonado/UVG/Sexto Semestre/Data Science/Proyecto2DS")

# Leyendo el dataset de csv importacion
# Honduras

SecG <- read.xlsx("USG1519.xlsx", sheet = 1, startRow = 1, colNames = TRUE,
                 rowNames = FALSE, detectDates = FALSE, skipEmptyRows = TRUE,
                 skipEmptyCols = TRUE, rows = NULL, cols = NULL, check.names = FALSE,
                 namedRegion = NULL, na.strings = "0", fillMergedCells = FALSE)

DescG <- read.xlsx("USG1519.xlsx", sheet = 2, startRow = 1, colNames = TRUE,
                 rowNames = FALSE, detectDates = FALSE, skipEmptyRows = TRUE,
                 skipEmptyCols = TRUE, rows = NULL, cols = NULL, check.names = FALSE,
                 namedRegion = NULL, na.strings = "NA", fillMergedCells = FALSE)

# Leyendo el dataset de csv importacion
# Honduras

SecH <- read.xlsx("USH1519.xlsx", sheet = 1, startRow = 1, colNames = TRUE,
                 rowNames = FALSE, detectDates = FALSE, skipEmptyRows = TRUE,
                 skipEmptyCols = TRUE, rows = NULL, cols = NULL, check.names = FALSE,
                 namedRegion = NULL, na.strings = "0", fillMergedCells = FALSE)

DescH <- read.xlsx("USH1519.xlsx", sheet = 2, startRow = 1, colNames = TRUE,
                 rowNames = FALSE, detectDates = FALSE, skipEmptyRows = TRUE,
                 skipEmptyCols = TRUE, rows = NULL, cols = NULL, check.names = FALSE,
                 namedRegion = NULL, na.strings = "NA", fillMergedCells = FALSE)

# Leyendo el dataset de csv importacion
# Nicaragua

SecN <- read.xlsx("USN1519.xlsx", sheet = 1, startRow = 1, colNames = TRUE,
                 rowNames = FALSE, detectDates = FALSE, skipEmptyRows = TRUE,
                 skipEmptyCols = TRUE, rows = NULL, cols = NULL, check.names = FALSE,
                 namedRegion = NULL, na.strings = "0", fillMergedCells = FALSE)

DescN <- read.xlsx("USN1519.xlsx", sheet = 2, startRow = 1, colNames = TRUE,
                 rowNames = FALSE, detectDates = FALSE, skipEmptyRows = TRUE,
                 skipEmptyCols = TRUE, rows = NULL, cols = NULL, check.names = FALSE,
                 namedRegion = NULL, na.strings = "NA", fillMergedCells = FALSE)

# Leyendo el dataset de csv importacion
# El Salvador

SecS <- read.xlsx("USS1519.xlsx", sheet = 1, startRow = 1, colNames = TRUE,
                 rowNames = FALSE, detectDates = FALSE, skipEmptyRows = TRUE,
                 skipEmptyCols = TRUE, rows = NULL, cols = NULL, check.names = FALSE,
                 namedRegion = NULL, na.strings = "NA", fillMergedCells = FALSE)

DescS <- read.xlsx("USS1519.xlsx", sheet = 2, startRow = 1, colNames = TRUE,
                 rowNames = FALSE, detectDates = FALSE, skipEmptyRows = TRUE,
                 skipEmptyCols = TRUE, rows = NULL, cols = NULL, check.names = FALSE,
                 namedRegion = NULL, na.strings = "0", fillMergedCells = FALSE)
```
```{r}
SecG[is.na(SecG)] <- 0
SecH[is.na(SecH)] <- 0
SecN[is.na(SecN)] <- 0
SecS[is.na(SecS)] <- 0
```

### Cambio de nombre a las columnas

```{r}

gsub2 <- function(de, a, x) {
    for(i in 1:length(de))
    x <- gsub(de[i], a[i], x)
    x
  }

cambioTitulos <- function(x){

# -------------------------------
# Títulos principales
# -------------------------------
  names(x)[1] <- "Sector"
  names(x)[2] <- "Categoria"
  names(x)[3] <- "Producto y Descripcion"
  
  # -------------------------------
  # Año 2015
  # -------------------------------
  names(x)[4] <- "01-2015"
  names(x)[5] <- "02-2015"
  names(x)[6] <- "03-2015"
  names(x)[7] <- "04-2015"
  names(x)[8] <- "05-2015"
  names(x)[9] <- "06-2015"
  names(x)[10] <- "07-2015"
  names(x)[11] <- "08-2015"
  names(x)[12] <- "09-2015"
  names(x)[13] <- "10-2015"
  names(x)[14] <- "11-2015"
  names(x)[15] <- "12-2015"
  
  # -------------------------------
  # Año 2016
  # -------------------------------
  names(x)[16] <- "01-2016"
  names(x)[17] <- "02-2016"
  names(x)[18] <- "03-2016"
  names(x)[19] <- "04-2016"
  names(x)[20] <- "05-2016"
  names(x)[21] <- "06-2016"
  names(x)[22] <- "07-2016"
  names(x)[23] <- "08-2016"
  names(x)[24] <- "09-2016"
  names(x)[25] <- "10-2016"
  names(x)[26] <- "11-2016"
  names(x)[27] <- "12-2016"
  
  # -------------------------------
  # Año 2017
  # -------------------------------
  names(x)[28] <- "01-2017"
  names(x)[29] <- "02-2017"
  names(x)[30] <- "03-2017"
  names(x)[31] <- "04-2017"
  names(x)[32] <- "05-2017"
  names(x)[33] <- "06-2017"
  names(x)[34] <- "07-2017"
  names(x)[35] <- "08-2017"
  names(x)[36] <- "09-2017"
  names(x)[37] <- "10-2017"
  names(x)[38] <- "11-2017"
  names(x)[39] <- "12-2017"
  
  # -------------------------------
  # Año 2018
  # -------------------------------
  names(x)[40] <- "01-2018"
  names(x)[41] <- "02-2018"
  names(x)[42] <- "03-2018"
  names(x)[43] <- "04-2018"
  names(x)[44] <- "05-2018"
  names(x)[45] <- "06-2018"
  names(x)[46] <- "07-2018"
  names(x)[47] <- "08-2018"
  names(x)[48] <- "09-2018"
  names(x)[49] <- "10-2018"
  names(x)[50] <- "11-2018"
  
  # Se eliminan filas no útiles
  x <- x[-c(1, 2), ] 
}

#Guatemala

Gde <- c('0000','0001','0002','0003','0004','0005','0006','0007','0008','0009','0010','0011', '0012', '0013', '0014', '0015', '0016', '0017', '0018', '0019', '0020','0021', '0022', '0023', '0024', '0025', '0026', '0027', '0028', '0029', '0030', '0031', '0032', '0033', '0034', '0035', '0036', '0037', '0038', '0039', '0040', '0041', '0042', '0043', 'AB01','AB02', 'AB03', 'CC', 'EX01', 'PR01')
Ga <- c('0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23', '24', '25', '26', '27', '28', '29', '30', '31', '32', '33', '34', '35', '36', '37', '38', '39', '40', '41', '42', '43', '44', '45', '46', '47', '48', '49')

SecG <- cambioTitulos(SecG)
SecG$Sector <- gsub2(Gde,Ga,SecG$Sector)


SecH <- cambioTitulos(SecH)

#Nicaragua

Nde <- c('0000', '0402', '0403', '0404', '0405', '0406', '0407', '0408', '0409', '0410', '0411', '0412', '0413', '0420', '0421', '0422', '0423', '0424', '0425', '0426', '0427', '0428', '0429', '0430', '0431', '0433', 'AB01', 'CC')

Na <- c('0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23', '24', '25', '26', '27')

SecN <- cambioTitulos(SecN)
SecN$Sector <- gsub2(Nde, Na, SecN$Sector)
SecS <- cambioTitulos(SecS)
```


```{r echo=FALSE}

#vector de sectores
## Guatemala
sectoresG <- strsplit(DescG[,c(2)], "-")
sectoresG <- data.frame(sectoresG)
sectoresG <- t(sectoresG[-c(2),])

## Honduras
sectoresH <- strsplit(DescH[,c(2)], "-")
sectoresH <- data.frame(sectoresH)
sectoresH <- t(sectoresH[-c(2),])

## Nigaragua

sectoresN <- strsplit(DescN[,c(2)], "-")
sectoresN <- data.frame(sectoresN)
sectoresN <- t(sectoresN[-c(2),])


```

```{r}

#Nicaragua
## 0
Nsec0 <- SecN[SecN$Sector == 0, ]
Nsec0 <- Nsec0[,-c(1,2,3)]
Nsec0[] <- lapply(Nsec0, as.numeric)
Nsum0 <- colSums(Nsec0[,-1])

## 1
Nsec1 <- SecN[SecN$Sector == 1, ]
Nsec1 <- Nsec1[,-c(1,2,3)]
Nsec1[] <- lapply(Nsec1, as.numeric)
Nsum1 <- colSums(Nsec1[,-1])


## 2
Nsec2 <- SecN[SecN$Sector == 2, ]
Nsec2 <- Nsec2[,-c(1,2,3)]
Nsec2[] <- lapply(Nsec2, as.numeric)
Nsum2 <- colSums(Nsec2[,-1])


## 3

Nsec3 <- SecN[SecN$Sector == 3, ]
Nsec3 <- Nsec3[,-c(1,2,3)]
Nsec3[] <- lapply(Nsec3, as.numeric)
Nsum3 <- colSums(Nsec3[,-1])


## 4

Nsec4 <- SecN[SecN$Sector == 4, ]
Nsec4 <- Nsec4[,-c(1,2,3)]
Nsec4[] <- lapply(Nsec4, as.numeric)
Nsum4 <- colSums(Nsec4[,-1])


## 5

Nsec5 <- SecN[SecN$Sector == 5, ]
Nsec5 <- Nsec5[,-c(1,2,3)]
Nsec5[] <- lapply(Nsec5, as.numeric)
Nsum5 <- colSums(Nsec5[,-1])


## 6

Nsec6 <- SecN[SecN$Sector == 6, ]
Nsec6 <- Nsec6[,-c(1,2,3)]
Nsec6[] <- lapply(Nsec6, as.numeric)
Nsum6 <- colSums(Nsec6[,-1])


## 7

Nsec7 <- SecN[SecN$Sector == 7, ]
Nsec7 <- Nsec7[,-c(1,2,3)]
Nsec7[] <- lapply(Nsec7, as.numeric)
Nsum7 <- colSums(Nsec7[,-1])


## 8

Nsec8 <- SecN[SecN$Sector == 8, ]
Nsec8 <- Nsec8[,-c(1,2,3)]
Nsec8[] <- lapply(Nsec8, as.numeric)
Nsum8 <- colSums(Nsec8[,-1])


## 9

Nsec9 <- SecN[SecN$Sector == 9, ]
Nsec9 <- Nsec9[,-c(1,2,3)]
Nsec9[] <- lapply(Nsec9, as.numeric)
Nsum9 <- colSums(Nsec9[,-1])


## 10

Nsec10 <- SecN[SecN$Sector == 1, ]
Nsec10 <- Nsec10[,-c(1,2,3)]
Nsec10[] <- lapply(Nsec10, as.numeric)
Nsum10 <- colSums(Nsec10[,-1])


## 11

Nsec11 <- SecN[SecN$Sector == 11, ]
Nsec11 <- Nsec11[,-c(1,2,3)]
Nsec11[] <- lapply(Nsec11, as.numeric)
Nsum11 <- colSums(Nsec11[,-1])

## 12

Nsec12 <- SecN[SecN$Sector == 12, ]
Nsec12 <- Nsec12[,-c(1,2,3)]
Nsec12[] <- lapply(Nsec12, as.numeric)
Nsum12 <- colSums(Nsec12[,-1])

##sector 13

Nsec13 <- subset(SecN, Sector == "13")
Nsec13 <- Nsec13[,-c(1,2,3)]
Nsec13[] <- lapply(Nsec13, as.numeric)
Nsum13 <- colSums(Nsec13[,-1])

##sector 14

Nsec14 <- subset(SecN, Sector == "14")
Nsec14 <- Nsec14[,-c(1,2,3)]
Nsec14[] <- lapply(Nsec14, as.numeric)
Nsum14 <- colSums(Nsec14[,-1])

##sector 15

Nsec15 <- subset(SecN, Sector == "15")
Nsec15 <- Nsec15[,-c(1,2,3)]
Nsec15[] <- lapply(Nsec15, as.numeric)
Nsum15 <- colSums(Nsec15[,-1])

##sector 16

Nsec16 <- subset(SecN, Sector == "16")
Nsec16 <- Nsec16[,-c(1,2,3)]
Nsec16[] <- lapply(Nsec16, as.numeric)
Nsum16 <- colSums(Nsec16[,-1])

##sector 17

Nsec17 <- subset(SecN, Sector == "17")
Nsec17 <- Nsec17[,-c(1,2,3)]
Nsec17[] <- lapply(Nsec17, as.numeric)
Nsum17 <- colSums(Nsec17[,-1])

##sector 18

Nsec18 <- subset(SecN, Sector == "18")
Nsec18 <- Nsec18[,-c(1,2,3)]
Nsec18[] <- lapply(Nsec18, as.numeric)
Nsum18 <- colSums(Nsec18[,-1])

##sector 19

Nsec19 <- subset(SecN, Sector == "19")
Nsec19 <- Nsec19[,-c(1,2,3)]
Nsec19[] <- lapply(Nsec19, as.numeric)
Nsum19 <- colSums(Nsec19[,-1])

##sector 20

Nsec20 <- subset(SecN, Sector == "20")
Nsec20 <- Nsec20[,-c(1,2,3)]
Nsec20[] <- lapply(Nsec20, as.numeric)
Nsum20 <- colSums(Nsec20[,-1])

##sector 21

Nsec21 <- subset(SecN, Sector == "21")
Nsec21 <- Nsec21[,-c(1,2,3)]
Nsec21[] <- lapply(Nsec21, as.numeric)
Nsum21 <- colSums(Nsec21[,-1])

##sector 22

Nsec22 <- subset(SecN, Sector == "22")
Nsec22 <- Nsec22[,-c(1,2,3)]
Nsec22[] <- lapply(Nsec22, as.numeric)
Nsum22 <- colSums(Nsec22[,-1])

##sector 23

Nsec23 <- subset(SecN, Sector == "23")
Nsec23 <- Nsec23[,-c(1,2,3)]
Nsec23[] <- lapply(Nsec23, as.numeric)
Nsum23 <- colSums(Nsec23[,-1])

##sector 24

Nsec24 <- subset(SecN, Sector == "24")
Nsec24 <- Nsec24[,-c(1,2,3)]
Nsec24[] <- lapply(Nsec24, as.numeric)
Nsum24 <- colSums(Nsec24[,-1])

##sector 25

Nsec25 <- subset(SecN, Sector == "25")
Nsec25 <- Nsec25[,-c(1,2,3)]
Nsec25[] <- lapply(Nsec25, as.numeric)
Nsum25 <- colSums(Nsec25[,-1])

##sector 26

Nsec26 <- subset(SecN, Sector == "26")
Nsec26 <- Nsec26[,-c(1,2,3)]
Nsec26[] <- lapply(Nsec26, as.numeric)
Nsum26 <- colSums(Nsec26[,-1])

##Sector 27

Nsec27 <- subset(SecN, Sector == "27")
Nsec27 <- Nsec0[,-c(1,2,3)]
Nsec27[] <- lapply(Nsec27, as.numeric)
Nsum27 <- colSums(Nsec27[,-1])

# Nsum27 tiene 52 objetos y no cuadra con las demas de 55 objetos.

Nica2 <- data.frame(Nsum0, Nsum1, Nsum2, Nsum3, Nsum4, Nsum5, Nsum6, Nsum7, Nsum8, Nsum9, Nsum10, Nsum11, Nsum12, Nsum13, Nsum14, Nsum15, Nsum16, Nsum17, Nsum18, Nsum19, Nsum20, Nsum21, Nsum22, Nsum23, Nsum24, Nsum25, Nsum26)


# Salen fechas demás, como x51, x52, etc.

#Idea para hacer la matriz
#crearMatriz <- function(x,y){
  #matriz <- matrix( nrow = 55, ncol = 50)
  #for (i in 0){
    #lista <- x[x$Sector == i,]
    #lista <- lista[,-c(1,2,3)]
    #lista[] <- lapply(lista, as.numeric)
    #suma <- colSums(lista[,-1])
    #matriz <- cbind(suma)
  #}
  #return(matriz)
#}

```
```{r}
#nuevoSecG <- crearMatriz(SecG,Ga)
```


